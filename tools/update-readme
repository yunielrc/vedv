#!/usr/bin/env bash
# shellcheck disable=SC2016
#
# Update readme
#
# This script should be executed after each successful test-all run
#

set -eu

export MANJARO_UNAME_A="$(uname -a)"
export MANJARO_PACKAGES_PROD="$(sed -e '/^##/d' -e '/^$/d' packages-prod-manjaro.versions)"

export VEDV_HELP="$(./dist/usr/bin/vedv --help)"

{
  echo '<!-- DO NOT EDIT THIS FILE; IT WAS GENERATED BY ./tools/update-readme -->'
  echo '<!-- EDIT README.md.tpl INSTEAD -->'

  envsubst '${MANJARO_UNAME_A},${MANJARO_PACKAGES_PROD},${VEDV_HELP}' <README.md.tpl
} >README.md
